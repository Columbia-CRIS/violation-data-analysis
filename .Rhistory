if(!exists("complete.active.quarters")){load("./San Antonio/output/result.RData")}
top.deaths <- complete.active.quarters %>% filter(active) %>% arrange(desc(num.death)) %>% select(mine.name, mine_id, year, quarter, num.death)
head(top.deaths, 20)
View(complete.active.quarters %>% filter(mine_id == 4608791))
rm(list=ls())
# Upper Big Branch: 4608436
# This is a temporary fix
# Inputs: raw accidents data and final data with only active mine-quarters
# Output: days lost, days restrict, deaths, and violations with only active mine-quarters
# setup
require(dplyr)
library(RcppRoll)
setwd("~/Git/violation-data-analysis")
# load accidents, violations, and function roll_over
if(!exists("accidents") |
!exists("full.days_lost.accidents.date") |
!exists("roll_over") |
!exists("mines")) {
load("./San Antonio/data/secret_ingredients.RData")
print("raw RData loaded")
}
# constant parameters
longest.period <- 3
actual.start.year <- 2000
end.year <- 2015
# generate accident_roll_over and death_roll_over
actual.accidents <- accidents %>% filter(is.element(inj_degr_desc, c("DAYS AWAY FROM WORK ONLY",
"DYS AWY FRM WRK & RESTRCTD ACT",
"DAYS RESTRICTED ACTIVITY ONLY",
"FATALITY",
"PERM TOT OR PERM PRTL DISABLTY",
"NO VALUE FOUND")))
actual.accidents["deaths"] <- 0
actual.accidents["perm_dis"] <- 0
# na.and.no.value.index <- is.element(actual.accidents$inj_degr_desc, "NO VALUE FOUND") & is.na(actual.accidents$days_lost)
actual.accidents[is.na(actual.accidents$days_lost), "days_lost"] <- 0
actual.accidents[is.na(actual.accidents$days_restrict), "days_restrict"] <- 0
actual.accidents[which(actual.accidents$inj_degr_desc == "FATALITY"), "deaths"] <- 1
actual.accidents[which(actual.accidents$inj_degr_desc == "PERM TOT OR PERM PRTL DISABLTY"), "perm_dis"] <- 1
actual.accidents$ai_dt_actual_date <- strftime(actual.accidents$ai_dt, "%F")
# rm(na.and.no.value.index, accidents)
quarter.level.num.days.lost <- actual.accidents %>% group_by(mine_id, cal_qtr, cal_yr)%>%
summarize(base = sum(days_lost, na.rm = T))
days_lost_rollover <- roll_over(actual.accidents,
quarter.level.num.days.lost,
longest.period,
actual.start.year,
end.year)
colnames(days_lost_rollover) <- c(
"mine_id", "quarter", "year",
"num.days.lost", "last.quarter.lost", "last.year.lost", "last.three.years.lost"
)
rm(quarter.level.num.days.lost)
quarter.level.num.days.restrict <- actual.accidents %>% group_by(mine_id, cal_qtr, cal_yr)%>%
summarize(base = sum(days_restrict, na.rm = T))
days_restrict_rollover <- roll_over(actual.accidents,
quarter.level.num.days.restrict,
longest.period,
actual.start.year,
end.year)
colnames(days_restrict_rollover) <- c(
"mine_id", "quarter", "year",
"num.days.restrict", "last.quarter.restrict", "last.year.restrict", "last.three.years.restrict"
)
rm(quarter.level.num.days.restrict)
quarter.level.num.deaths <- actual.accidents %>% group_by(mine_id, cal_qtr, cal_yr)%>%
summarize(base = sum(deaths, na.rm = T))
death_rollover <- roll_over(actual.accidents,
quarter.level.num.deaths,
longest.period,
actual.start.year,
end.year)
colnames(death_rollover) <- c(
"mine_id", "quarter", "year",
"num.death", "last.quarter.death", "last.year.death", "last.three.years.death"
)
rm(quarter.level.num.deaths)
quarter.level.num.perm_dis <- actual.accidents %>% group_by(mine_id, cal_qtr, cal_yr)%>%
summarize(base = sum(perm_dis, na.rm = T))
dis_rollover <- roll_over(actual.accidents,
quarter.level.num.perm_dis,
longest.period,
actual.start.year,
end.year)
colnames(dis_rollover) <- c(
"mine_id", "quarter", "year",
"num.dis", "last.quarter.dis", "last.year.dis", "last.three.years.dis"
)
rm(quarter.level.num.perm_dis)
# cleanup violations
active_violation_rollover = full.days_lost.accidents.date %>%
select(mine_id, year, quarter, viol.quantity, last.quarter.y, last.year.y, last.three.years.y)
active_violation_rollover$active <- TRUE
colnames(active_violation_rollover) <- c(
"mine_id", "year", "quarter",
"viol.quantity", "last.quarter.viol", "last.year.viol", "last.three.years.viol",
"active"
)
# join accidents and violation
temp <- merge(days_lost_rollover, days_restrict_rollover, by = c("mine_id","year","quarter"),all=TRUE)
temp[is.na(temp)] <- 0
temp <- merge(temp, death_rollover, by = c("mine_id","year","quarter"),all=TRUE)
temp[is.na(temp)] <- 0
temp <- merge(temp, dis_rollover, by = c("mine_id","year","quarter"),all=TRUE)
temp[is.na(temp)] <- 0
temp <- merge(temp, active_violation_rollover, by = c("mine_id","year","quarter"),all.x=TRUE)
View(temp %>% filter(mine_id == 4608791))
temp1 <- temp %>% mutate(
active = ifelse(is.na(active) &
num.days.lost + num.days.restrict + num.death + num.dis +
last.quarter.lost + last.quarter.restrict + last.quarter.death + last.quarter.dis +
last.year.lost + last.year.restrict + last.quarter.death + last.quarter.dis +
last.three.years.lost + last.three.years.restrict + last.three.years.death + last.three.years.dis
> 0, TRUE,
ifelse(is.na(active),
FALSE,
ifelse(active, TRUE, FALSE))
)
)
View(temp1 %>% filter(mine_id == 4608791))
temp <- temp %>% mutate(
active = ifelse(is.na(active) &
num.days.lost + num.days.restrict + num.death + num.dis +
last.quarter.lost + last.quarter.restrict + last.quarter.death + last.quarter.dis +
last.year.lost + last.year.restrict + last.quarter.death + last.quarter.dis +
last.three.years.lost + last.three.years.restrict + last.three.years.death + last.three.years.dis
> 0, TRUE,
ifelse(is.na(active),
FALSE,
ifelse(active, TRUE, FALSE))
)
)
temp[is.na(temp$active),]$active <- FALSE
temp[is.na(temp)] <- 0
colnames(mines) <- c("mine_id", "mine.name")
temp <- merge(temp, mines, by = "mine_id", all.x=TRUE)
temp <- temp[, c(1, 25, 2:3, 24, 4:23)]
# result
complete.active.quarters <- temp
# colnames(complete.active.quarters) <-
#   c("mine_id", "year", "quarter",
#     "num.days.lost", "last.quarter.lost", "last.year.lost", "last.three.years.lost",
#     "num.days.restrict", "last.quarter.restrict", "last.year.restrict", "last.three.years.restrict",
#     "num.death", "last.quarter.death", "last.year.death", "last.three.years.death",
#     "viol.quantity", "last.quarter.viol", "last.year.viol", "last.three.years.viol",
#     "active", "mine.name")
# complete.active.quarters <- complete.active.quarters[, c(1, 21, 2:3, 20, 4:19)]
save(complete.active.quarters, file="./San Antonio/output/result.RData")
# see simple_lm.R for simple lm
unique(temp$active)
if(!exists("complete.active.quarters")){load("./San Antonio/output/result.RData")}
top.deaths <- complete.active.quarters %>% filter(active) %>% arrange(desc(num.death)) %>% select(mine.name, mine_id, year, quarter, num.death)
head(top.deaths, 10)
library(ggplot2)
if(!exists("complete.active.quarters")){load("./San Antonio/output/result.RData")}
yearly.viol <- complete.active.quarters %>%
filter(mine_id == 4608791 & year < 2006) %>%
group_by(year) %>%
summarise(count = sum(viol.quantity))
qplot(x = year, y = count, data = yearly.viol, geom = "line",
main = "Number of Yearly Violations",
xlab = "Year", ylab = "count")
View(complete.active.quarters %>% filter(mine_id == 4608791))
View(complete.active.quarters %>% filter(mine_id == 4608791) %>% select(year, quarter, num.death, viol.quantity))
rm(list=ls())
load("/Users/l16cn/Git/violation-data-analysis/A New Hope/albert_aggregate_new_features_from_assessed_violation.RData")
View(merged_violation_data)
load("/Users/l16cn/Git/violation-data-analysis/Analysis/data/msha_violation.RData")
View(mshs_violation)
View(mshs_violation %>% filter(violator_id == 4608791))
View(mshs_violation %>% filter(citation_nbr == 4608791))
violations <- read.csv("./San Antonio/data/AssessedViolations.csv", stringsAsFactors = FALSE)
assessed_violations <- violations
head(assessed_violations)
colnames(assessed_violations)[1] <- "mine_id"
rm(violations)
View(assessed_violations)
violations <- assessed_violations
rm(assessed_violations)
x <- as.Date(violations$OCCURRENCE_DT, "%m/%d/%Y")
x <- as.Date(violations[1,]$OCCURRENCE_DT, "%m/%d/%Y")
x <- as.numeric(as.Date(violations[1,]$OCCURRENCE_DT, "%m/%d/%Y"), "%m")
x <- as.numeric(format(as.Date(violations[1,]$OCCURRENCE_DT, "%m/%d/%Y"), "%m"))
x <- as.Date(violations$OCCURRENCE_DT, "%m/%d/%Y")
x <- as.Date(violations[1,]$OCCURRENCE_DT, "%m/%d/%Y")
x <- as.numeric(format(as.Date(violations[1,]$OCCURRENCE_DT, "%m/%d/%Y"), "%m"))
violations2 <- violations %>% mutate(
cal_yr = as.numeric(format(as.Date(OCCURRENCE_DT, "%m/%d/%Y"), "%Y")),
cal_mm = as.numeric(format(as.Date(OCCURRENCE_DT, "%m/%d/%Y"), "%m"))
)
head(violations2 %>% select(OCCURRENCE_DT, cal_yr, cal_mm))
violations2 <- violations %>% mutate(
cal_yr = as.numeric(format(as.Date(OCCURRENCE_DT, "%m/%d/%Y"), "%Y")),
cal_mm = as.numeric(format(as.Date(OCCURRENCE_DT, "%m/%d/%Y"), "%m")),
cal_qtr = ifelse(
cal_mm >9, 4, ifelse(
cal_mm > 6, 3, ifelse(
cal_mm > 3, 2, 1
)
)
)
)
head(violations2 %>% select(OCCURRENCE_DT, cal_yr, cal_mm, cal_qtr))
violations <- violations2
head(violations %>% select(OCCURRENCE_DT, cal_yr, cal_mm, cal_qtr))
save(complete.active.quarters, file="./San Antonio/data/albert_violation.RData")
save(violations, file="./San Antonio/data/albert_violation.RData")
rm(list=ls())
load("./San Antonio/data/secret_ingredients.RData")
load("./San Antonio/data/albert_violation.RData")
View(violations)
violations$violation <- 1
View(violations)
violations.lite <- violations %>% select(mine_id, cal_qtr, cal_yr, violation)
save(violations.lite, file="./San Antonio/data/albert_violation.RData")
rm(list=ls())
if(!exists("accidents") |
!exists("violations.lite") |
!exists("roll_over") |
!exists("mines")) {
load("./San Antonio/data/secret_ingredients.RData")
load("./San Antonio/data/albert_violation.RData")
print("raw RData loaded")
}
# constant parameters
longest.period <- 3
actual.start.year <- 2000
end.year <- 2015
# generate accident_roll_over and death_roll_over
actual.accidents <- accidents %>% filter(is.element(inj_degr_desc, c("DAYS AWAY FROM WORK ONLY",
"DYS AWY FRM WRK & RESTRCTD ACT",
"DAYS RESTRICTED ACTIVITY ONLY",
"FATALITY",
"PERM TOT OR PERM PRTL DISABLTY",
"NO VALUE FOUND")))
actual.accidents["deaths"] <- 0
actual.accidents["perm_dis"] <- 0
# na.and.no.value.index <- is.element(actual.accidents$inj_degr_desc, "NO VALUE FOUND") & is.na(actual.accidents$days_lost)
actual.accidents[is.na(actual.accidents$days_lost), "days_lost"] <- 0
actual.accidents[is.na(actual.accidents$days_restrict), "days_restrict"] <- 0
actual.accidents[which(actual.accidents$inj_degr_desc == "FATALITY"), "deaths"] <- 1
actual.accidents[which(actual.accidents$inj_degr_desc == "PERM TOT OR PERM PRTL DISABLTY"), "perm_dis"] <- 1
actual.accidents$ai_dt_actual_date <- strftime(actual.accidents$ai_dt, "%F")
# rm(na.and.no.value.index, accidents)
quarter.level.num.days.lost <- actual.accidents %>% group_by(mine_id, cal_qtr, cal_yr)%>%
summarize(base = sum(days_lost, na.rm = T))
days_lost_rollover <- roll_over(actual.accidents,
quarter.level.num.days.lost,
longest.period,
actual.start.year,
end.year)
colnames(days_lost_rollover) <- c(
"mine_id", "quarter", "year",
"num.days.lost", "last.quarter.lost", "last.year.lost", "last.three.years.lost"
)
rm(quarter.level.num.days.lost)
quarter.level.num.days.restrict <- actual.accidents %>% group_by(mine_id, cal_qtr, cal_yr)%>%
summarize(base = sum(days_restrict, na.rm = T))
days_restrict_rollover <- roll_over(actual.accidents,
quarter.level.num.days.restrict,
longest.period,
actual.start.year,
end.year)
colnames(days_restrict_rollover) <- c(
"mine_id", "quarter", "year",
"num.days.restrict", "last.quarter.restrict", "last.year.restrict", "last.three.years.restrict"
)
rm(quarter.level.num.days.restrict)
quarter.level.num.deaths <- actual.accidents %>% group_by(mine_id, cal_qtr, cal_yr)%>%
summarize(base = sum(deaths, na.rm = T))
death_rollover <- roll_over(actual.accidents,
quarter.level.num.deaths,
longest.period,
actual.start.year,
end.year)
colnames(death_rollover) <- c(
"mine_id", "quarter", "year",
"num.death", "last.quarter.death", "last.year.death", "last.three.years.death"
)
rm(quarter.level.num.deaths)
quarter.level.num.perm_dis <- actual.accidents %>% group_by(mine_id, cal_qtr, cal_yr)%>%
summarize(base = sum(perm_dis, na.rm = T))
dis_rollover <- roll_over(actual.accidents,
quarter.level.num.perm_dis,
longest.period,
actual.start.year,
end.year)
colnames(dis_rollover) <- c(
"mine_id", "quarter", "year",
"num.dis", "last.quarter.dis", "last.year.dis", "last.three.years.dis"
)
rm(quarter.level.num.perm_dis)
quarter.level.viol.quantity <- violations.lite %>% group_by(mine_id, cal_qtr, cal_yr)%>%
summarize(base = sum(violation, na.rm = T))
violation_rollover <- roll_over(violations.lite,
quarter.level.viol.quantity,
longest.period,
actual.start.year,
end.year)
colnames(violation_rollover) <- c(
"mine_id", "quarter", "year",
"viol.quantity", "last.quarter.viol", "last.year.viol", "last.three.years.viol"
)
rm(quarter.level.viol.quantity)
View(violation_rollover)
head(violation_rollover %>% filter(year == 2000 & last.three.years.viol > 0)
)
head(violation_rollover %>% filter(year == 2000 & quarter == 1 & last.three.years.viol > 0))
head(violation_rollover %>% filter(mine_id == 1202215))
temp <- merge(days_lost_rollover, days_restrict_rollover, by = c("mine_id","year","quarter"),all=TRUE)
temp[is.na(temp)] <- 0
temp <- merge(temp, death_rollover, by = c("mine_id","year","quarter"),all=TRUE)
temp[is.na(temp)] <- 0
temp <- merge(temp, dis_rollover, by = c("mine_id","year","quarter"),all=TRUE)
temp[is.na(temp)] <- 0
temp <- merge(temp, violation_rollover, by = c("mine_id","year","quarter"),all.x=TRUE)
temp[is.na(temp)] <- 0
temp <- temp %>% mutate(
active = ifelse(num.days.lost + num.days.restrict + num.death + num.dis +
last.quarter.lost + last.quarter.restrict + last.quarter.death + last.quarter.dis +
last.year.lost + last.year.restrict + last.quarter.death + last.quarter.dis +
last.three.years.lost + last.three.years.restrict + last.three.years.death + last.three.years.dis
> 0, TRUE, FALSE
)
)
View(temp)
temp <- merge(days_lost_rollover, days_restrict_rollover, by = c("mine_id","year","quarter"),all=TRUE)
temp[is.na(temp)] <- 0
temp <- merge(temp, death_rollover, by = c("mine_id","year","quarter"),all=TRUE)
temp[is.na(temp)] <- 0
temp <- merge(temp, dis_rollover, by = c("mine_id","year","quarter"),all=TRUE)
temp[is.na(temp)] <- 0
temp <- merge(temp, violation_rollover, by = c("mine_id","year","quarter"),all.x=TRUE)
temp[is.na(temp)] <- 0
temp <- temp %>% mutate(
active = ifelse(
num.days.lost + last.quarter.lost + last.year.lost + last.three.years.lost +
num.days.restrict + last.quarter.restrict + last.year.restrict + last.three.years.restrict +
num.death + last.quarter.death + last.year.death + last.three.years.death +
num.dis + last.quarter.dis + last.year.dis + last.three.years.dis +
viol.quantity + last.quarter.viol + last.year.viol + last.three.years.viol
> 0, TRUE, FALSE
)
)
head(temp %>% filter(!active))
head(temp %>% group_by(active) %>% summarise(count = n()))
colnames(mines) <- c("mine_id", "mine.name")
temp <- merge(temp, mines, by = "mine_id", all.x=TRUE)
temp <- temp[, c(1, 25, 2:3, 24, 4:23)]
head(temp)
complete.active.quarters <- temp
save(complete.active.quarters, file="./San Antonio/output/result.RData")
knitr::opts_chunk$set(echo = TRUE)
require(dplyr)
knitr::opts_knit$set(root.dir = "~/Git/violation-data-analysis")
if(!exists("complete.active.quarters")){load("./San Antonio/output/result.RData")}
top.deaths <- complete.active.quarters %>% filter(active) %>% arrange(desc(num.death)) %>% select(mine.name, mine_id, year, quarter, num.death)
head(top.deaths, 10)
if(!exists("accidents")){load("./San Antonio/data/secret_ingredients.RData")}
fatal.accidents <- accidents %>%
filter(inj_degr_desc == "FATALITY") %>%
group_by(ai_class_desc) %>%
summarise(count = n()
) %>%
arrange(desc(count))
head(fatal.accidents, 10)
# {r upper big branch, echo=FALSE, fig.show = 'hold', out.width = '49%'}
library(ggplot2)
if(!exists("complete.active.quarters")){load("./San Antonio/output/result.RData")}
# upper.big.branch <- complete.active.quarters %>% filter(mine_id == 4608436 & (year < 2010 | (year == 2010 & quarter < 2))) %>%
#   select(year, quarter, num.days.lost, viol.quantity)
# # ggplot() +
# #   geom_line(data = upper.big.branch, aes(x = year + quarter / 4, y = viol.quantity), color = "red") +
# #   geom_line(data = upper.big.branch, aes(x = year + quarter / 4, y = num.days.lost), color = "green")
# qplot(x=year + quarter / 4, y=viol.quantity, data=upper.big.branch, geom = "line",
#      main = "Upper Big Branch: Number of Quarterly Violations",
#      xlab = "Year", ylab = "Count")
yearly.viol <- complete.active.quarters %>%
filter(mine_id == 4608436 & year < 2010) %>%
group_by(year) %>%
summarise(count = sum(viol.quantity))
qplot(x = year, y = count, data = yearly.viol, geom = "line",
main = "Number of Yearly Violations",
xlab = "Year", ylab = "count")
library(ggplot2)
if(!exists("complete.active.quarters")){load("./San Antonio/output/result.RData")}
yearly.viol <- complete.active.quarters %>%
filter(mine_id == 4608791 & year < 2006) %>%
group_by(year) %>%
summarise(count = sum(viol.quantity))
qplot(x = year, y = count, data = yearly.viol, geom = "line",
main = "Number of Yearly Violations",
xlab = "Year", ylab = "count")
library(ggplot2)
if(!exists("complete.active.quarters")){load("./San Antonio/output/result.RData")}
# darby.mine <- complete.active.quarters %>% filter(mine_id == 1518185 & (year < 2006 | (year == 2006 & quarter < 2))) %>%
#   select(year, quarter, num.days.lost, viol.quantity)
# qplot(x=year + quarter / 4, y=viol.quantity, data=darby.mine, geom = "line",
#      main = "Darby Mine No. 1: Number of Quarterly Violations",
#      xlab = "Year", ylab = "Count")
yearly.viol <- complete.active.quarters %>%
filter(mine_id == 1518185 & year < 2006) %>%
group_by(year) %>%
summarise(count = sum(viol.quantity))
qplot(x = year, y = count, data = yearly.viol, geom = "line",
main = "Number of Yearly Violations",
xlab = "Year", ylab = "count")
library(ggplot2)
if(!exists("complete.active.quarters")){load("./San Antonio/output/result.RData")}
# gibson.mine <- complete.active.quarters %>% filter(mine_id == 1202215 & (year < 2007 | (year == 2007 & quarter < 3))) %>%
#   select(year, quarter, num.days.lost, viol.quantity)
# qplot(x=year + quarter / 4, y=viol.quantity, data=gibson.mine, geom = "line",
#      main = "Gibson Mine: Number of Quarterly Violations",
#      xlab = "Year", ylab = "Count")
yearly.viol <- complete.active.quarters %>%
filter(mine_id == 1202215 & year < 2007) %>%
group_by(year) %>%
summarise(count = sum(viol.quantity))
qplot(x = year, y = count, data = yearly.viol, geom = "line",
main = "Number of Yearly Violations",
xlab = "Year", ylab = "count")
library(ggplot2)
if(!exists("complete.active.quarters")){load("./San Antonio/output/result.RData")}
yearly.viol <- complete.active.quarters %>%
filter(mine_id == 1502132 & year < 2010) %>%
group_by(year) %>%
summarise(count = sum(viol.quantity))
qplot(x = year, y = count, data = yearly.viol, geom = "line",
main = "Number of Yearly Violations",
xlab = "Year", ylab = "count")
if(!exists("complete.active.quarters")){load("./San Antonio/output/result.RData")}
top.days.lost <- complete.active.quarters %>% filter(active) %>% arrange(desc(num.days.lost)) %>% select(mine.name, year, quarter, num.days.lost)
head(top.days.lost, 10)
if(!exists("accidents")){load("./San Antonio/data/secret_ingredients.RData")}
new.era <- accidents %>%
filter(mine_id == 1102752 & cal_yr == 2005 & cal_qtr == 2) %>%
arrange(desc(days_lost)) %>%
select(
ai_dt,
days_lost,
ai_class_desc
#ai_occ_desc
#ai_narr
)
head(new.era)
if(!exists("accidents")){load("./San Antonio/data/secret_ingredients.RData")}
new.era.top.accidents <- accidents %>%
filter(mine_id == 1102752 & cal_yr == 2005 & cal_qtr == 2) %>%
arrange(desc(days_lost)) %>%
select(
ai_dt,
days_lost,
ai_class_desc,
ai_occ_desc,
ai_narr
)
print(as.character(new.era.top.accidents$ai_narr[1]))
if(!exists("new.era.top.accidents")){
if(!exists("accidents")){load("./San Antonio/data/secret_ingredients.RData")}
new.era.top.accidents <- accidents %>%
filter(mine_id == 1102752 & cal_yr == 2005 & cal_qtr == 2) %>%
arrange(desc(days_lost)) %>%
select(
ai_dt,
days_lost,
ai_class_desc,
ai_occ_desc,
ai_narr
)
}
print(as.character(new.era.top.accidents$ai_narr[2]))
if(!exists("complete.active.quarters")){load("./San Antonio/output/result.RData")}
num.days.lm <- lm(0*num.death+1*num.days.lost+1*num.days.restrict~last.quarter.lost+last.year.lost+last.three.years.lost
+last.quarter.restrict+last.year.restrict+last.three.years.restrict
+last.quarter.viol+last.year.viol+last.three.years.viol
+last.quarter.death+last.year.death+last.three.years.death,
data=complete.active.quarters %>% filter(active))
summary(num.days.lm)
if(!exists("complete.active.quarters")){load("./San Antonio/output/result.RData")}
num.deaths.lm <- lm(1*num.death+0*num.days.lost+0*num.days.restrict~last.quarter.lost+last.year.lost+last.three.years.lost
+last.quarter.restrict+last.year.restrict+last.three.years.restrict
+last.quarter.viol+last.year.viol+last.three.years.viol
+last.quarter.death+last.year.death+last.three.years.death,
data=complete.active.quarters %>% filter(active))
summary(num.deaths.lm)
library(ggplot2)
if(!exists("complete.active.quarters")){load("./San Antonio/output/result.RData")}
yearly.viol <- complete.active.quarters %>%
filter(mine_id == 4201715 & year < 2007) %>%
group_by(year) %>%
summarise(count = sum(viol.quantity))
qplot(x = year, y = count, data = yearly.viol, geom = "line",
main = "Number of Yearly Violations",
xlab = "Year", ylab = "count")
library(ggplot2)
if(!exists("violations.lite")){load("./San Antonio/data/albert_violation.RData")}
yearly.viol <- violations.lite %>%
filter(mine_id == 101322 & cal_yr < 2001 & cal_yr >= 1990) %>%
group_by(year) %>%
summarise(count = sum(violation))
library(ggplot2)
if(!exists("violations.lite")){load("./San Antonio/data/albert_violation.RData")}
yearly.viol <- violations.lite %>%
filter(mine_id == 101322 & cal_yr < 2001 & cal_yr >= 1990) %>%
group_by(cal_yr) %>%
summarise(count = sum(violation))
qplot(x = cal_yr, y = count, data = yearly.viol, geom = "line",
main = "Number of Yearly Violations",
xlab = "Year", ylab = "count")
View(violations.lite %>% filter(mine_id == 101322))
unique(violations.lite %>% filter(mine_id == 101322))
unique(violations.lite %>% filter(mine_id == 101322 & cal_yr < 2000))
