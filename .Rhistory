12 + 8
12 * 64
12 + 8
12 * 64
12 + 8
12 * 64
x ^ 2
x = 3
x ^ 2
x = 3
x ^ 2
x = 3
x ^ 2
x <- 1:9
x
x(1)
x[1]
x[3]
x[end]
n
y <- 3
rm y
rm(y)
rm(x)
a <- 32
b <- "bucky"
class(a)
class(b)
c <- "Jul-4-2016"
class(c)
c[3]
help(rm)
is.numeric(a)
is.numeric(b)
~is.numeric(b)
not(is.numeric(b))
!is.numeric(b)
a == b
a != b
name <- "Yu Luo"
nchar(name)
nchar("name")
x <- as.Data("2016-07-04")
x <- as.Date("2016-07-04")
x
class(x)
x <= 3
license()
x <- 3
x
require(dplyr)
library(RcppRoll)
setwd("~/Git/violation-data-analysis")
# load accidents, violations, and function roll_over
if(!exists("accidents") | !exists("full.days_lost.accidents.date") | !exists("roll_over")) {
load("./San Antonio/raw_accidents_fine_viol.RData")
print("raw RData loaded")
}
# constant parameters
longest.period <- 3
actual.start.year <- 2000
end.year <- 2015
# generate accident_roll_over and death_roll_over
actual.accidents <- accidents %>% filter(is.element(inj_degr_desc, c("DAYS AWAY FROM WORK ONLY",
"DYS AWY FRM WRK & RESTRCTD ACT",
"DAYS RESTRICTED ACTIVITY ONLY",
"FATALITY",
"PERM TOT OR PERM PRTL DISABLTY",
"NO VALUE FOUND")))
actual.accidents["deaths"] <- 0
na.and.no.value.index <- is.element(actual.accidents$inj_degr_desc, "NO VALUE FOUND") & is.na(actual.accidents$days_lost)
actual.accidents[na.and.no.value.index, "days_restrict"] <- 0
actual.accidents[na.and.no.value.index, "days_lost"] <- 0
actual.accidents[which(actual.accidents$inj_degr_desc == "FATALITY"), "deaths"] <- 1
actual.accidents$ai_dt_actual_date <- strftime(actual.accidents$ai_dt, "%F")
rm(c(na.and.no.value.index, accidents))
rm(na.and.no.value.index, accidents)
quarter.level.num.days.lost <- actual.accidents %>% group_by(mine_id, cal_qtr, cal_yr)%>%
summarize(base = sum(days_lost, na.rm = T))
days_lost_rollover <- roll_over(actual.accidents,
quarter.level.num.days.lost,
longest.period,
actual.start.year,
end.year)
rm(quarter.level.num.days.lost)
quarter.level.num.days.restrict <- actual.accidents %>% group_by(mine_id, cal_qtr, cal_yr)%>%
summarize(base = sum(days_restrict, na.rm = T))
days_restrict_rollover <- roll_over(actual.accidents,
quarter.level.num.days.restrict,
longest.period,
actual.start.year,
end.year)
colnames(days_restrict_rollover)[4] <- "num.days.restrict"
rm(quarter.level.num.days.restrict)
quarter.level.num.deaths <- actual.accidents %>% group_by(mine_id, cal_qtr, cal_yr)%>%
summarize(base = sum(deaths, na.rm = T))
death_rollover <- roll_over(actual.accidents,
quarter.level.num.deaths,
longest.period,
actual.start.year,
end.year)
colnames(death_rollover)[4] <- "num.deaths"
rm(quarter.level.num.deaths)
a <- True
a <- true
1 == 1
a <- TRUE
not a
not(a)
~a
!a
active_violation_rollover = full.days_lost.accidents.date %>%
select(mine_id, year, quarter, viol.quantity, last.quarter.y, last.year.y, last.three.years.y)
active_violation_rollover$active <- TRUE
View(active_violation_rollover)
temp <- merge(days_lost_rollover, days_restrict_rollover, by = c("mine_id","year","quarter"),all=TRUE)
temp[is.na(temp)] <- 0
temp <- merge(temp, death_rollover, by = c("mine_id","year","quarter"),all=TRUE)
temp[is.na(temp)] <- 0
temp <- merge(temp, active_violation_rollover, by = c("mine_id","year","quarter"),all=TRUE)
temp[is.na(temp$active)]$active <- 0
View(temp)
temp <- merge(days_lost_rollover, days_restrict_rollover, by = c("mine_id","year","quarter"),all=TRUE)
temp[is.na(temp)] <- 0
temp <- merge(temp, death_rollover, by = c("mine_id","year","quarter"),all=TRUE)
temp[is.na(temp)] <- 0
temp <- merge(temp, active_violation_rollover, by = c("mine_id","year","quarter"),all.x=TRUE)
View(temp)
temp[,2]
temp[2,]$active
temp[is.na(temp$active),]$active <- FALSE
head(temp[!temp$active,])
temp[is.na(temp)] <- 0
complete.active.quarters <- temp
save(complete.active.quarters, file="./San Antonio/result.RData")
View(complete.active.quarters)
colnames(complete.active.quarters) <-
c("mine_id", "year", "quarter",
"num.days.lost", "last.quarter.lost", "last.year.lost", "last.three.years.lost",
"num.days.restrict", "last.quarter.restrict", "last.year.restrict", "last.three.years.restrict",
"num.days.death", "last.quarter.death", "last.year.death", "last.three.years.death",
"viol.quantity", "last.quarter.viol", "last.year.viol", "last.three.years.viol",
"active")
1:2
1:5
c(1:3, 20, 4:19)
complete.active.quarters(, c(1:3, 20, 4:19))
complete.active.quarters[], c(1:3, 20, 4:19)]
complete.active.quarters[, c(1:3, 20, 4:19)]
complete.active.quarters <- complete.active.quarters[, c(1:3, 20, 4:19)]
save(complete.active.quarters, file="./San Antonio/result.RData")
summary(lm(num.days.lost~last.year.lost, data=complete.active.quarters))
summary(lm(num.days.lost~last.year.lost, data=complete.active.quarters %>% filter (active)))
save(complete.active.quarters, file="./San Antonio/result.RData")
